{% extends "layout/_base_cinema.html" %}
{% load bootstrap4 %}
{% load static %}

{% block title %} Внести зміни в акцію {% endblock title%}

{% block content %}

<head>
    <script type="text/javascript" src="{% static 'pages/js/jQuery_3.6.0.js' %}"></script>
    <script type="text/javascript" src="{% static 'pages/js/chart.js/Chart.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'pages/js/pages_general.js' %}"></script>
    <script type="text/javascript" src="{% static 'pages/js/moment.min.js' %}"></script>
    <script type="application/json" src="{% static 'pages/js/moment.min.js.map' %}"></script>
    <script type="application/json" src="{% static 'pages/js/daterangepicker/daterangepicker.js' %}"></script>
    <script type="text/javascript" src="{% static 'pages/js/tempusdominus-bootstrap-4.min.js' %}"></script>
    <script src="{% static 'pages/js/jqvmap/jquery.vmap.min.js' %}"></script>
    <script src="{% static 'pages/js/jqvmap/maps/jquery.vmap.usa.js' %}"></script>
    <script src="{% static 'pages/js/jqvmap/maps/jquery.vmap.ukraine.js' %}"></script>
    <script src="{% static 'pages/js/jqvmap/maps/jquery.vmap.UkraineOblasti.js' %}"></script>

    <script src="{% static 'pages/js/jquery-knob/jquery.knob.min.js' %}"></script>
    <script src="{% static 'pages/js/sparklines/sparkline.js' %}"></script>
    <script src="{% static 'pages/js/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js' %}"></script>

  

    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.css">

    <link rel="stylesheet" href="{% static 'pages/css/tempusdominus-bootstrap-4.min.css' %}"/>
    <link rel="stylesheet" href="{% static 'pages/css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'pages/css/OverlayScrollbars.min.css' %}">
    <link rel="stylesheet" href="{% static 'pages/css/adminlte.min.css' %}">
    <link rel="stylesheet" href="{% static 'pages/css/icheck-bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'pages/css/style.css'%}">
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">

    <link rel="icon" href="{% static 'pages/images/cinema_logo_2.png' %}">


</head>


<div class="row" id="main_card_table">
    <div class="card col-12 col-lg-10">

      <div class="row mt-3 justify-content-end">
        <div class="col-12 col-md-12 col-lg-5 col-xl-4 align-self-end">
          <div class="small-box bg-warning">

          <div class="row mx-3">
            <div class="col-12 col-md-8">
              <div class="inner badge badge-warning text-wrap">
                <h3>{{ users_counter }}</h3>
                <p>Кількість зареєстрованих користувачів</p>
              </div>
            </div>
            <div class="col-none col-md-4">
              <div class="icon float-right">
                <i class="ion ion-person-add"></i>
              </div>
            </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <!-- /.card -->
        <div class="card col-12 col-xl-5 align-self-center">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-chart-pie mr-1"></i>
              Статистика користувачів за містом
            </h3>
          </div>
          <!-- /.card-header -->
          <div class="card-body">
            <div class="row">
              <div class="col-md-8">
                <div class="chart-responsive">
                  <canvas id="pieChart" width="350" height="250"></canvas>
                </div>
                <!-- ./chart-responsive -->
              </div>
            </div>
            <!-- /.row -->
          </div>
          <!-- /.card-body -->
        </div>
        <!-- /.card -->
        <!-- ________________sales graph___________________ -->
        <div class="col-12 col-xl-6">
          <div class="card bg-gradient-info my-0">
            <div class="card-header border-0">
              <h3 class="card-title">
                <i class="fas fa-chart-pie mr-1"></i>
                Кількість придбаних та заброньованих квитків
              </h3>

              <div class="card-tools">
                <button type="button" class="btn bg-info btn-sm" data-card-widget="collapse">
                  <i class="fas fa-minus"></i>
                </button>
                <button type="button" class="btn bg-info btn-sm" data-card-widget="remove">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <canvas class="chart" id="line-chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
            </div>
            <!-- /.card-body -->

        </div>
        </div>
        <!-- ________________sales graph___________________ -->

{% comment %} 
        <div class="col-3">
          <div class="small-box bg-warning">
            <div class="inner">
              <h3>{{ users_counter }}</h3>
              <p>Кількіст зареєстрованих користувачів</p>
            </div>
            <div class="icon">
              <i class="ion ion-person-add"></i>
            </div>
          </div> {% endcomment %}
        {% comment %} </div> {% endcomment %}
        
      
    </div>
        <div class="row">
        <div class="card mt-4 col-12 col-lg-11">

            <div class="card-header">
              <h3 class="card-title">
                <i class="fas fa-chart-pie mr-1"></i>
                Статистика вівідувань сайту за пристроямі
              </h3>
            </div><!-- /.card-header -->
            <div class="card-body">
              <!-- /.d-flex -->
              <div class="position-relative mb-4">
                <canvas id="visitors-chart" height="200"></canvas>
              </div>

              <div class="d-flex flex-row justify-content-end">

                <span class="mr-2">
                  <i class="fas fa-square text-primary"></i> all devices
                </span>
                <span class="mr-2">
                  <i class="fas fa-square text-warning"></i> tablet_and_sensor
                </span>
                <span class="mr-2">
                  <i class="fas fa-square text-success"></i> pc
                </span>
                <span class="mr-2">
                  <i class="fas fa-square text-info"></i> mobile
                </span>

              </div>
            </div>
        </div>
        </div>
      <div class="row">
        <!-- Map card -->
        <div class="card bg-gradient-primary col-12 col-xl-6">
          <div class="card-header border-0">
            <h3 class="card-title">
              <i class="fas fa-map-marker-alt mr-1"></i>
              Visitors
            </h3>
            <!-- card tools -->
            <div class="card-tools">
              <button type="button" class="btn btn-primary btn-sm daterange" title="Date range">
                <i class="far fa-calendar-alt"></i>
              </button>
              <button type="button" class="btn btn-primary btn-sm" data-card-widget="collapse" title="Collapse">
                <i class="fas fa-minus"></i>
              </button>
            </div>
            <!-- /.card-tools -->
          </div>
          <div class="card-body">
            <div id="world-map" style="height: 250px; width: 100%;"></div>
          </div>
          <!-- /.card-body-->
          <div class="card-footer bg-transparent">
            <div class="row">
              <div class="col-4 text-center">
                <div id="sparkline-1"></div>
                <div class="text-white">Visitors</div>
              </div>
              <!-- ./col -->
              <div class="col-4 text-center">
                <div id="sparkline-2"></div>
                <div class="text-white">Online</div>
              </div>
              <!-- ./col -->
              <div class="col-4 text-center">
                <div id="sparkline-3"></div>
                <div class="text-white">Sales</div>
              </div>
              <!-- ./col -->
            </div>
            <!-- /.row -->
          </div>
        </div>
        <!-- /.card -->
        <div class="card col-12 col-xl-5">
            <div class="card-header">
              <h3 class="card-title">
                <i class="fas fa-chart-pie mr-1"></i>
                Стать відвідувачів
              </h3>
            </div><!-- /.card-header -->
            <div class="card-body">
              <!-- /.d-flex -->
              <canvas id="pie-chart-sex" width="500" height="500"></canvas>
            </div>
        </div>
        <!-- /.card -->
      </div>   

        {{ date_labels_list|json_script:'date_label'}}
        {{ all_devices|json_script:'all_devices'}}
        {{ tablet_and_sensor|json_script:'tablet_and_sensor'}}
        {{ pc|json_script:'pc'}}
        {{ mobile|json_script:'mobile'}}
        {{ all_devices|json_script:'all_devices'}}
        {{ shows_per_day|json_script:'shows_per_day'}}
        {{ town_dict|json_script:'town_dict'}}
        {{ buy_per_day|json_script:'buy_per_day'}}
        {{ book_per_day|json_script:'book_per_day'}}
        {{ sex|json_script:'sex'}}


          </div>
    </div>
</div>

<script>
  $(function () {
    'use strict'
  
    var ticksStyle = {
      fontColor: '#495057',
      fontStyle: 'bold'
    }
  
    var mode = 'index'
    var intersect = true
  
    var date_label = JSON.parse(document.getElementById('date_label').textContent)
    var all_devices = JSON.parse(document.getElementById('all_devices').textContent)
    var tablet_and_sensor = JSON.parse(document.getElementById('tablet_and_sensor').textContent)
    var mobile = JSON.parse(document.getElementById('mobile').textContent)
    var pc = JSON.parse(document.getElementById('pc').textContent)
    var all_devices = JSON.parse(document.getElementById('all_devices').textContent)
    var shows_per_day = JSON.parse(document.getElementById('shows_per_day').textContent)
    var town_dict = JSON.parse(document.getElementById('town_dict').textContent)
    var buy_per_day = JSON.parse(document.getElementById('buy_per_day').textContent)
    var book_per_day = JSON.parse(document.getElementById('book_per_day').textContent)
    var sex = JSON.parse(document.getElementById('sex').textContent)


    console.log(tablet_and_sensor)
    var $visitorsChart = $('#visitors-chart')
    var visitorsChart = new Chart($visitorsChart, {
      data: {
        labels: date_label,
        datasets: [{
          type: 'line',
          data: all_devices,
          backgroundColor: 'transparent',
          borderColor: '#007bff',
          pointBorderColor: '#007bff',
          pointBackgroundColor: '#007bff',
          fill: false
        },
        {
          type: 'line',
          data: tablet_and_sensor,
          backgroundColor: 'tansparent',
          borderColor: '#ffc107',
          pointBorderColor: '#ffc107',
          pointBackgroundColor: '#ffc107',
          fill: false
        },
        {
          type: 'line',
          data: pc,
          backgroundColor: 'tansparent',
          borderColor: '#28a745',
          pointBorderColor: '#28a745',
          pointBackgroundColor: '#28a745',
          fill: false
        },
        {
          type: 'line',
          data: mobile,
          backgroundColor: 'tansparent',
          borderColor: '#17a2b8',
          pointBorderColor: '#17a2b8',
          pointBackgroundColor: '#17a2b8',
          fill: false
        },
      ]
      },
      options: {
        maintainAspectRatio: false,
        tooltips: {
          mode: mode,
          intersect: intersect
        },
        hover: {
          mode: mode,
          intersect: intersect
        },
        legend: {
          display: false
        },
        scales: {
          yAxes: [{
            gridLines: {
              display: true,
              lineWidth: '4px',
              color: 'rgba(0, 0, 0, .2)',
              zeroLineColor: 'transparent'
            },
            ticks: $.extend({
              beginAtZero: true,
              suggestedMax: 200
            }, ticksStyle)
          }],
          xAxes: [{
            display: true,
            gridLines: {
              display: false
            },
            ticks: ticksStyle
          }]
        }
      }
    })
    
     

  var salesChartData = {
    //labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
    labels: date_label,
    datasets: [
      {
        label: 'Digital Goods',
        backgroundColor: 'rgba(60,141,188,0.9)',
        borderColor: 'rgba(60,141,188,0.8)',
        pointRadius: false,
        pointColor: '#3b8bba',
        pointStrokeColor: 'rgba(60,141,188,1)',
        pointHighlightFill: '#fff',
        pointHighlightStroke: 'rgba(60,141,188,1)',
        data: shows_per_day
      },
    ]
  }

  var salesChartOptions = {
    maintainAspectRatio: false,
    responsive: true,
    legend: {
      display: false
    },
    scales: {
      xAxes: [{
        gridLines: {
          display: false
        }
      }],
      yAxes: [{
        gridLines: {
          display: false
        }
      }]
    }
  }
//**************************************************************
//-------------
  // - PIE CHART -
  //-------------
  // Get context with jQuery - using jQuery's .get() method.
  //console.log(town_dict)
  var pieChartCanvas = $('#pieChart').get(0).getContext('2d')
  var pieData = {
//    labels: [
//      'Chrome',
//      'IE',
//      'FireFox',
//      'Safari',
//      'Opera',
//      'Navigator'
//    ],
    //*********************************************************
    labels: Object.keys(town_dict),
    datasets: [
      {
        data: Object.values(town_dict),
        //data: [700, 500, 400, 600, 300, 100],
        backgroundColor: ['#f56954', '#00a65a', '#f39c12', '#00c0ef', '#3c8dbc', '#d2d6de']
      }
    ]
  }
  var pieOptions = {
    responsive: false,
    legend: {
      display: true,
      position: 'bottom',
      alignment : 'start',
      
    }
  }
  // Create pie or douhnut chart
  // You can switch between pie and douhnut using the method below.
  // eslint-disable-next-line no-unused-vars
  var pieChart = new Chart(pieChartCanvas, {
    type: 'doughnut',
    data: pieData,
    options: pieOptions
  })

  //-----------------
  // - END PIE CHART -
  //-----------------

  // Sales graph chart
  var salesGraphChartCanvas = $('#line-chart').get(0).getContext('2d')
  // $('#revenue-chart').get(0).getContext('2d');

  var salesGraphChartData = {
    labels: date_label,
    datasets: [
      {
        label: 'Куплені квитки',
        fill: false,
        borderWidth: 2,
        lineTension: 0,
        spanGaps: true,
        borderColor: '#f6fa00',
        pointRadius: 3,
        pointHoverRadius: 7,
        pointColor: '#f6fa00',
        pointBackgroundColor: '#f6fa00',
        data: buy_per_day
      },
      {
        label: 'Заброньовані квитки',
        fill: false,
        borderWidth: 2,
        lineTension: 0,
        spanGaps: true,
        borderColor: '#f70202',
        pointRadius: 3,
        pointHoverRadius: 7,
        pointColor: '#f70202',
        pointBackgroundColor: '#f70202',
        data: book_per_day
      },
    ]
  }

  var salesGraphChartOptions = {
    maintainAspectRatio: false,
    responsive: true,
    legend: {
      display: false
    },
    scales: {
      xAxes: [{
        ticks: {
          fontColor: '#efefef',
          autoSkip: false
        },
        gridLines: {
          display: false,
          color: '#ffffff',
          drawBorder: false
        }
      }],
      yAxes: [{
        ticks: {
          stepSize: 250,
          fontColor: '#ffffff'
        },
        gridLines: {
          display: true,
          color: '#ffffff',
          drawBorder: false
        }
      }]
    }
  }

  // This will get the first returned node in the jQuery collection.
  // eslint-disable-next-line no-unused-vars
  var salesGraphChart = new Chart(salesGraphChartCanvas, { // lgtm[js/unused-local-variable]
    type: 'line',
    data: salesGraphChartData,
    options: salesGraphChartOptions
  })

  //--------------------map-----------------------
    /* jQueryKnob */
    $('.knob').knob()

    // jvectormap data
    var visitorsData = {
    //  US: 398, // USA
    //  SA: 400, // Saudi Arabia
    //  CA: 1000, // Canada
    //  DE: 500, // Germany
    //  FR: 760, // France
    //  CN: 300, // China
    //  AU: 700, // Australia
    //  BR: 600, // Brazil
    //  IN: 800, // India
    //  GB: 320, // Great Britain
    //  RU: 3000 // Russia
    }
    // World map by jvectormap
    $('#world-map').vectorMap({
      map: 'ukraine_ua',
      //map: 'UkraineOblasti_ua',
      backgroundColor: 'Indigo',
      //regionsSelectable: true,
      regionStyle: {
        initial: {
          fill: 'rgba(255, 255, 255, 0.7)',
          'fill-opacity': 1,
          stroke: 'rgba(0,0,0,.2)',
          'stroke-width': 1,
          'stroke-opacity': 1
        }
      },
      series: {
        regions: [{
          values: visitorsData,
          scale: ['#ffffff', '#0154ad'],
          normalizeFunction: 'polynomial'
        }]
      },

      onRegionLabelShow: function (e, el, code) {
        if (typeof visitorsData[code] !== 'undefined') {
          el.html(el.html() + ': ' + visitorsData[code] + ' new visitors')
        }
      }
      

    })
  
    // Sparkline charts
    var sparkline1 = new Sparkline($('#sparkline-1')[0], { width: 80, height: 50, lineColor: '#92c1dc', endColor: '#ebf4f9' })
    var sparkline2 = new Sparkline($('#sparkline-2')[0], { width: 80, height: 50, lineColor: '#92c1dc', endColor: '#ebf4f9' })
    var sparkline3 = new Sparkline($('#sparkline-3')[0], { width: 80, height: 50, lineColor: '#92c1dc', endColor: '#ebf4f9' })
  
    sparkline1.draw([1000, 1200, 920, 927, 931, 1027, 819, 930, 1021])
    sparkline2.draw([515, 519, 520, 522, 652, 810, 370, 627, 319, 630, 921])
    sparkline3.draw([15, 19, 20, 22, 33, 27, 31, 27, 19, 30, 21])

//--------------------end-map-----------------------
    console.log(sex)
    console.log('!!!!')
  new Chart(document.getElementById("pie-chart-sex"), {
    type: 'pie',
    data: {
      labels: Object.keys(sex),
      datasets: [{
        label: "Population (millions)",
        backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850"],
        data: Object.values(sex)
      }]
    },
    options: {
      legend: {
        display: false},
      title: {
        display: true,
        text: 'Із 100% відвідувачів які придбали або забронювало квитки.'
      }
    }
});


  });
</script>



{% endblock content %}